apiVersion: v1
kind: Pod
metadata:
  name: frontend
  namespace: ambassador
spec:
  volumes:
    - name: haproxy
      configMap:
        name: haproxy-cfg
  containers:
  - image: nginx:alpine
    name: frontend
    command: ["sh", "-c", "while true; do sleep 5; date && curl $SERVICE_NAME:8080 -m 2; done"]
    env:
    - name: SERVICE_NAME
      value: "localhost"
  - image: haproxy:alpine
    name: haproxy
    volumeMounts:
      - name: haproxy
        mountPath: /usr/local/etc/haproxy
