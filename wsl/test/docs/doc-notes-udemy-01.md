cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh
cd ../script
make reset-heavy

alias k=kubectl
export do="--dry-run=client -o yaml"
alias kn='kubectl config set-context --current --namespace '
alias ke='k explain'
alias kgp='k get po'
alias kaf='k apply -f'

ã“ã®å¤§é‡ã®å•é¡Œç¾¤ã‚’ç²¾æŸ»ã—ã¦ã€  
**CKADæœ¬ç•ªç›´å‰2æ—¥é–“ã§ã€Œå…ˆã«å®Œç’§ã«ã™ã¹ãå•é¡Œã€ã¨ã€Œå¾Œå›ã—ã«ã—ã¦ã„ã„å•é¡Œã€**ã‚’æ˜ç¢ºã«æŒ¯ã‚Šåˆ†ã‘ã¾ã™ã€‚

---

## âœ… åˆ¤æ–­åŸºæº–

| åˆ†é¡ | æ„å›³ |
|------|------|
| ğŸŸ© å…ˆã«å®Œç’§ã«ã™ã¹ã | åŸºæœ¬ãƒªã‚½ãƒ¼ã‚¹ã§ç¢ºå®Ÿã«æº€ç‚¹ã‚’å–ã‚Œã‚‹ï¼å‡ºé¡Œé »åº¦ãŒé«˜ã„ï¼æ§‹é€ ãŒã‚·ãƒ³ãƒ—ãƒ« |
| ğŸŸ¨ å¾Œå›ã—ã ãŒæ‹¾ãˆã‚‹ãªã‚‰æ‹¾ã† | å¿œç”¨ã ãŒå¾—ç‚¹æºã«ãªã‚Šã†ã‚‹ï¼ç†è§£ã—ã‚„ã™ã‘ã‚Œã°ã‚„ã‚‹ä¾¡å€¤ã‚ã‚Š |
| ğŸŸ¥ æ¨ã¦ã¦ã‚ˆã„ or æœ€å¾Œã«ä¸€æ°—è¦‹ | å‡ºé¡Œé »åº¦ãŒä½ã„ï¼é‡ã„ï¼æ™‚é–“ã‚’é£Ÿã„ã‚„ã™ã„ or CKADç¯„å›²å¤–ï¼ˆhelmãªã©ï¼‰ |

---

## âœ… å„å•é¡Œã®åˆ†é¡ã¨ã‚³ãƒ¡ãƒ³ãƒˆ

| å•é¡Œç•ªå· | å„ªå…ˆ | æŠ€è¡“å†…å®¹ | ã‚³ãƒ¡ãƒ³ãƒˆ |
|----------|------|-----------|----------|
| 1        | ğŸŸ©   | `Podãƒ­ã‚° + ãƒ©ãƒ™ãƒ«selector` | åŸºæœ¬æ“ä½œãƒ»æ—©ãå‡¦ç†ã§ãã‚‹ã€å®Œç’§ã«ã™ã¹ã |
| 2        | ğŸŸ©   | `Secretæ›´æ–°ï¼ˆenvFromï¼‰` | CKADé »å‡ºã€‚ä¿®æ­£æ§‹æ–‡ã«æ…£ã‚Œã‚‹ã¹ã |
| 3        | ğŸŸ©   | `ConfigMap + volumeMount` | å¿…é ˆåˆ†é‡ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬å†ç¾ã«è‡ªä¿¡ã‚’æŒã¡ãŸã„ |
| 4        | ğŸŸ¨   | `ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠ + ConfigMapãƒã‚¦ãƒ³ãƒˆ` | å¿œç”¨ç³»ã€ä½™è£•ãŒã‚ã‚Œã°ã‚„ã‚‹ |
| 5        | ğŸŸ©   | `RBACã§Podä¸€è¦§æ¨©é™ä¿®æ­£` | å‡ºé¡Œæ•°å°‘ãªã‚ã ãŒã€èª­è§£åŠ›ç¢ºèªã«è‰¯ã„ã€‚éƒ¨åˆ†ç‚¹ç‹™ã„ã§ã‚‚ä¾¡å€¤ã‚ã‚Š |
| 6        | ğŸŸ¥   | `NetworkPolicy` | å‡ºãŸã‚‰æ‹¾ã†ã€‚è©¦é¨“ã§ã¯æœ€å°æ§‹æ–‡ã‚’æš—è¨˜ã ã‘ã—ã¦ãŠãæˆ¦ç•¥ã§OK |
| 7        | ğŸŸ¨   | `Resourceåˆ¶é™ï¼ˆLimitRangeï¼‰` | å‡ºé¡Œæ•°å°‘ãªã„ãŒã€æ§‹é€ ã¯è»½ã„ã€‚ä½™è£•ãŒã‚ã‚Œã°ç¿’å¾— |
| 8        | ğŸŸ¨   | `CronJobæ§‹æ–‡ãƒ»Jobç”Ÿæˆ` | æœ€å°æ§‹æ–‡ã ã‘è¦šãˆã‚Œã°å¾—ç‚¹æºã€æ·±è¿½ã„ã¯ä¸è¦ |
| 9        | ğŸŸ¨   | `ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠ + emptyDirå…±æœ‰` | å¿œç”¨ç³»ã ãŒvolumeç†è§£ã®ç¢ºèªã«æœ€é©ã€‚æ¼”ç¿’ä¾¡å€¤ã‚ã‚Š |
| 10       | ğŸŸ¨   | `SecurityContext` | ä½™è£•ãŒã‚ã‚Œã°æ¼”ç¿’ã€‚è©¦é¨“é »åº¦ã¯ä½ã‚ |
| 11       | ğŸŸ¥   | `Ingress` | æ§‹æ–‡é‡ãã€ã‚¯ãƒ©ã‚¹ã‚¿ä¾å­˜ã€‚æœ€å°æ§‹æ–‡ã ã‘æš—è¨˜æˆ¦ç•¥ã§ååˆ† |
| 12       | ğŸŸ¨   | `Canary Deployment` | CKADã£ã½ããªã„ãŒè¨­å•ãŒã‚ã‹ã‚Šã‚„ã™ã„ãªã‚‰æ‹¾ã† |
| 13       | ğŸŸ©   | `Service selectorä¿®æ­£` | ã‚ã¡ã‚ƒãã¡ã‚ƒé »å‡ºã€‚å®Œç’§ã«ã—ã¦ãŠãã¹ã |
| 14       | ğŸŸ©   | `RollingUpdateæˆ¦ç•¥` | å‡ºé¡Œå¤šã„ã€‚`maxSurge`ã¨`maxUnavailable`ã«æ…£ã‚Œã‚‹ã¹ã |
| 15       | ğŸŸ©   | `Liveness/Readiness Probe` | è¶…é »å‡ºã€‚httpGetå›ºå®šã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ |
| 16       | ğŸŸ¥   | `Helm` | CKADå¯¾è±¡å¤–ã€‚å®Œå…¨ã‚¹ã‚­ãƒƒãƒ—ã§OK |
| 17       | ğŸŸ©   | `PVC Pending â†’ PVæ¡ä»¶ä¸ä¸€è‡´ä¿®æ­£` | PVC/PVãƒãƒƒãƒãƒ³ã‚°ã¯ã‚ˆãå‡ºã‚‹ã€‚å¿…ãšã§ãã‚‹ã‚ˆã†ã« |
| 18       | ğŸŸ©   | `Podã‚¨ãƒ©ãƒ¼åŸå› ä¿®æ­£ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»æ§‹æ–‡ãªã©ï¼‰` | å‡ºé¡Œé »åº¦é«˜ã€ç¾å ´åŠ›ã‚‚è©¦ã•ã‚Œã‚‹ã€å®Œç’§ã«ã™ã¹ã |

---

## ğŸ¯ æœ€å„ªå…ˆã§ã€Œå®Œç’§ã€ã«ã™ã¹ãå•é¡Œï¼ˆå¾©ç¿’ãƒ»å†ç¾é †ï¼‰

1. å•é¡Œ1ï¼ˆãƒ­ã‚°ãƒ»Podé¸æŠï¼‰
2. å•é¡Œ2ï¼ˆSecretã®ä¿®æ­£ï¼‰
3. å•é¡Œ3ï¼ˆConfigMapãƒã‚¦ãƒ³ãƒˆï¼‰
4. å•é¡Œ5ï¼ˆRBACã‚¨ãƒ©ãƒ¼èª¿æŸ»ï¼‰
5. å•é¡Œ13ï¼ˆServiceæ¥ç¶šï¼‰
6. å•é¡Œ14ï¼ˆRollingUpdateï¼‰
7. å•é¡Œ15ï¼ˆProbesï¼‰
8. å•é¡Œ17ï¼ˆPVCâ†’PVï¼‰
9. å•é¡Œ18ï¼ˆPodèµ·å‹•å¤±æ•—ã®èª¿æŸ»ï¼‰

ğŸ‘‰ **ã“ã‚Œã ã‘ã§6ã€œ8å‰²ã®å¾—ç‚¹ã‚¾ãƒ¼ãƒ³ã‚’ã‚«ãƒãƒ¼ã§ãã¾ã™ã€‚**

---

## ğŸ”¥ å­¦ç¿’åŠ¹ç‡ã‚’ä¸Šã’ã‚‹å®Ÿè¡Œä¾‹ï¼ˆç›´å‰2æ—¥ï¼‰

| æ™‚é–“å¸¯ | ã‚¿ã‚¹ã‚¯ |
|--------|--------|
| åˆå‰   | å•é¡Œ1,2,3,13ï¼ˆæ‰‹ç™–ã‚’å›ºã‚ã‚‹ï¼‰ |
| åˆå¾Œ   | å•é¡Œ14,15,17,18ï¼ˆä¸­æ ¸æŠ€è¡“ã«é›†ä¸­ï¼‰ |
| å¤œ     | å•é¡Œ5ï¼ˆRBACèª­è§£ï¼‰ã€3å•é€šã—æ¨¡è©¦ |

---

å¿…è¦ã§ã‚ã‚Œã°ã€ã€Œã“ã®å„ªå…ˆé †ã§ä¸¦ã‚“ã YAMLå†ç¾ã‚»ãƒƒãƒˆï¼ˆ+æ§‹é€ ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼‰ã€ã‚‚ä½œæˆã§ãã¾ã™ã€‚æ¬²ã—ã„ã§ã™ã‹ï¼Ÿ

=========================================================
å•é¡Œ1
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/1/resources.yaml

å•é¡Œ
filteråå‰ç©ºé–“ã§ã¯ã€pod-1ã‹ã‚‰pod-10ã¾ã§ã®10å€‹ã®PodãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®Podã«ã¯ã€app: "Podå"ã®ãƒ©ãƒ™ãƒ«ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ãƒ©ãƒ™ãƒ«ã‚’æŒã¤Podã®ãƒ­ã‚°ã‚’ã€pods.logã«å‡ºåŠ›ã—ã¦ä¸‹ã•ã„ã€‚

app: pod-3
app: pod-7
app: pod-8

---------------------------------------------------------
---------------------------------------------------------

ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ2
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/2/resources.yaml



å•é¡Œ

credentialåå‰ç©ºé–“ã§ã€login DeploymentãŒå®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¯ç’°å¢ƒå¤‰æ•°USERNAMEã¨PASSWORDã‚’creds Secretã‹ã‚‰å‚ç…§ã—ã¦ã„ã¾ã™ã€‚credsãŒä¿æŒã—ã¦ã„ã‚‹PASSWORDã®å€¤ã‚’my-new-passwordã«å¤‰æ›´ã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
# å…¨ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚’ç¢ºèªï¼ˆPod, Service, Deploymentãªã©ã™ã¹ã¦ï¼‰
kubectl get all  #  deployment.apps/loginã‚’å–å¾—


# Podã«å…¥ã£ã¦ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªï¼ˆDeploymentçµŒç”±ã§ã¯ãªãPodåã§ï¼‰
kubectl exec -it deployment.apps/login -- /bin/sh
env

# Secretã®å†…å®¹ï¼ˆbase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çŠ¶æ…‹ï¼‰ã‚’ç¢ºèª
kubectl get secret creds -o yaml  # Secret 'creds' ã®å€¤ã‚’YAMLå½¢å¼ã§è¡¨ç¤º

# Secret/ConfigMapå¤‰æ›´ã‚’åæ˜ ã™ã‚‹ãŸã‚ã«Deploymentã‚’å†èµ·å‹•
kubectl rollout restart deployment.apps/login # Deployment 'login' ã‚’ãƒ­ãƒ¼ãƒªãƒ³ã‚°å†èµ·å‹•
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»

=========================================================
å•é¡Œ3
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh
minikube delete
minikube start --ports=32100:32100

1. wgetã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ä»¥ä¸‹ã®URLã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/3/updated_index.html



2. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/3/resources.yaml



å•é¡Œ

webåå‰ç©ºé–“ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹my-web Deploymentã¯ã€nginxã‚¤ãƒ¡ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹Podã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚Deploymentã¯NodePortã‚¿ã‚¤ãƒ—ã®ã‚µãƒ¼ãƒ“ã‚¹ã§å…¬é–‹ã•ã‚Œã¦ãŠã‚Šã€curl controlplane:32100ã‚’å®Ÿè¡Œã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã¾ã™ã€‚
ã‚³ãƒ³ãƒ†ãƒŠãŒè¡¨ç¤ºã™ã‚‹index.htmlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€updated_index.htmlã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

index.htmlã‚’ã‚­ãƒ¼ã€updated_index.htmlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒªãƒ¥ãƒ¼ã¨ã—ã¦ä¿æŒã™ã‚‹ConfigMapã‚’ä½œæˆã—ã€/usr/share/nginx/htmlãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹ConfigMapã‚’æ›´æ–°ã—ã¦ä¸‹ã•ã„ã€‚ConfigMapã®åå‰ã¯new-index-cmã¨ã—ã¾ã™

---------------------------------------------------------


---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
# Serviceã®ç¨®é¡ï¼ˆNodePortã‹ï¼‰ã€ãƒãƒ¼ãƒˆç•ªå·ã€selectorã‚’ç¢ºèª
kubectl get svc -o wide  

# Deploymentã®ConfigMapãƒã‚¦ãƒ³ãƒˆå…ˆã‚„volumeå®šç¾©ã‚’ç¢ºèª
kubectl get deploy my-web -o yaml  

# å¯¾è±¡Podã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»IPãƒ»ãƒãƒ¼ãƒ‰é…ç½®ãƒ»ãƒ©ãƒ™ãƒ«ã‚’ç¢ºèª
kubectl get po -l app=my-web -o wide  

# ãƒãƒ¼ãƒ‰ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ï¼ˆcontrolplaneãŒä½¿ãˆãªã„å ´åˆã«å‚™ãˆã¦ï¼‰
kubectl get nodes -o wide  

# NodePortçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã€è¡¨ç¤ºã•ã‚Œã‚‹index.htmlã‚’ç¢ºèª
curl http://controlplane:32100  

# åå‰è§£æ±ºã§ããªã„å ´åˆã«ç›´æ¥NodeIPã§curlç¢ºèª
curl http://192.168.58.2:32100  
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»

=========================================================
å•é¡Œ4
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

1. wgetã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€æ¬¡ã®URLã‹ã‚‰frontend.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/4/frontend.yaml



2. wgetã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€æ¬¡ã®URLã‹ã‚‰haproxy.cfgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/4/haproxy.cfg



3. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/4/resources.yaml



å•é¡Œ

ambassadoråå‰ç©ºé–“ã§ç¨¼åƒã—ã¦ã„ã‚‹frontend Podã¯ã€ãƒãƒ¼ãƒˆç•ªå·8080ã‚’ä½¿ç”¨ã—ã¦ã€ï¼•ç§’æ¯ã«api-serviceã«æ¥ç¶šã—ã¾ã™ã€‚api-serviceã®ãƒãƒ¼ãƒˆç•ªå·ã¯ã€9090ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã€frontend PodãŒå¼•ãç¶šãapi-serviceã«æ¥ç¶šã§ãã‚‹æ§˜ã«ã€æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ ã—ã¦ä¸‹ã•ã„ã€‚



1. api-serviceã®å…¬é–‹ã™ã‚‹ãƒãƒ¼ãƒˆç•ªå·ã‚’ã€9090ç•ªã«å¤‰æ›´ã—ã¦ä¸‹ã•ã„



2. haproxy.cfgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€haproxy-cfgã¨ã„ã†ConfigMapã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚



3. frontend Podã«ã€haproxy:alpineã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ ã—ã¦ä¸‹ã•ã„ã€‚ã‚³ãƒ³ãƒ†ãƒŠåã¯haproxyã¨ã—ã€/usr/local/etc/haproxyãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«haproxy-cfg ConfigMapã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ä¸‹ã•ã„ã€‚ãªãŠã€å¤‰æ›´ã«ã¯frontend Podã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹frontend.yamlã‚’ä½¿ç”¨ã—ã¦ä¸‹ã•ã„ã€‚



4. frontendã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰Serviceã¸ã®æ¥ç¶šãŒã€æ–°ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ­£ã—ããƒ—ãƒ­ã‚­ã‚·ã•ã‚Œã‚‹æ§˜ã«ã€æ¥ç¶šå…ˆã‚’api-serviceã‹ã‚‰localhostã«å¤‰æ›´ã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
k logs frontend --since=15s
k create cm haproxy-cfg --from-file=haproxy.cfg





ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»



=========================================================
å•é¡Œ5
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/5/resources.yaml



å•é¡Œ

serviceåå‰ç©ºé–“ã§å®Ÿè¡Œã•ã‚Œã‚‹pod-reader Deploymentã¯ã€5ç§’ã”ã¨ã«"kubectl get pods"ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ç¾åœ¨ã€Deploymentã®ãƒ­ã‚°ã«ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã€ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¦ä¸‹ã•ã„ã€‚ãªãŠã€è§£ç­”ã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã¯å…¨ã¦ä½œæˆã•ã‚Œã¦ãŠã‚Šã€æ–°ã—ã„ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚



1. pod-reader Deploymentã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª¿æŸ»ã—ã¦ä¸‹ã•ã„ã€‚



2. pod-reader Deploymentã‚’ä¿®æ­£ã—ã€ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ãªã£ã¦ã„ã‚‹å•é¡Œã‚’è§£æ±ºã—ã¦ä¸‹ã•ã„ã€‚


---------------------------------------------------------


---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
# ç›´è¿‘15ç§’ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ç‰¹å®š
k logs deployment/pod-reader --since=15s  

# default ServiceAccount ã§Podä¸€è¦§ãŒå–å¾—ã§ãã‚‹ã‹æ¤œè¨¼
k auth can-i list pods --as=system:serviceaccount:service:default

# ç¾åœ¨Namespaceå†…ã«å­˜åœ¨ã™ã‚‹ServiceAccountã‚’ç¢ºèªï¼ˆå€™è£œã‚’æ¢ã™ï¼‰
k get sa

# pod-reader-saãŒPodä¸€è¦§å–å¾—ã§ãã‚‹ã‹æ¤œè¨¼ï¼ˆæ­£è§£å€™è£œï¼‰
k auth can-i list pods --as=system:serviceaccount:service:pod-reader-sa

# Deployment 'pod-reader' ã«æ­£ã—ã„ServiceAccountã‚’å‰²ã‚Šå½“ã¦ã‚‹
k set sa deploy pod-reader pod-reader-sa

# ä¿®æ­£ã‚’åæ˜ ã™ã‚‹ãŸã‚Deploymentã‚’ãƒ­ãƒ¼ãƒªãƒ³ã‚°å†èµ·å‹•
k rollout restart deploy pod-reader

# å†èµ·å‹•å¾Œã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã€ã‚¨ãƒ©ãƒ¼è§£æ¶ˆã‚’ç¢ºèª
k logs deployment/pod-reader --since=15s
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»




=========================================================
å•é¡Œ6
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/6/resources.yaml



å•é¡Œ

networkåå‰ç©ºé–“ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯å…¨ã¦ã®Podã®å†…å‘ãï¼ˆingressï¼‰ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚web Podã‹ã‚‰api Podã¸ã®å†…å‘ãã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã€api-netpolã¨ã„ã†NetworkPolicyãŒä½œæˆã•ã‚Œã¾ã—ãŸãŒã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚web Podã«å¿…è¦ãªè¨­å®šã‚’è¿½åŠ ã—ã€api Podã¸ã®æ¥ç¶šã‚’æœ‰åŠ¹åŒ–ã—ã¦ä¸‹ã•ã„ã€‚

ãªãŠã€è§£ç­”ã«å¿…è¦ãªKubernetesãƒªã‚½ãƒ¼ã‚¹ã¯å…¨ã¦ä½œæˆã•ã‚Œã¦ãŠã‚Šã€æ–°ã—ãä½œæˆã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãŸã€æ—¢å­˜ã®NetworkPolicyã¯å¤‰æ›´ã¾ãŸã¯å‰Šé™¤ã—ãªã„ã§ãã ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
k get pods -o wide     # å…¨ã¦ã®Podã‚’ãƒãƒ¼ãƒ‰ã‚„IPãªã©è©³ç´°æƒ…å ±ä»˜ãã§ä¸€è¦§è¡¨ç¤º
k exec web -- sh -c "curl -m 2 aaa.aaa.a.a"   # web Podå†…ã§æŒ‡å®šIPã¸2ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œ
k get netpol apinet -o yaml  # apinetã¨ã„ã†NetworkPolicyã®è¨­å®šå†…å®¹ã‚’YAMLå½¢å¼ã§å–å¾—
k label pods web role=backend  # web Podã« role=backend ãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸ã—ã¦NetworkPolicyã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æ¡ä»¶ã‚’æº€ãŸã™
k exec web -- sh -c "curl -m 2 aaa.aaa.a.a"   # ãƒ©ãƒ™ãƒ«ä»˜ä¸å¾Œã€å†åº¦web Podã‹ã‚‰API Podã¸ã®æ¥ç¶šã‚’ç¢ºèª



ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ7
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/7/resources.yaml



å•é¡Œ

resource-managementåå‰ç©ºé–“ã§ã¯ã€cpu-resource-constraintã¨ã„ã†LimitRangeã«ã‚ˆã£ã¦ã€CPUãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ã®æœ€å¤§å€¤ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

nginxã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦managedã¨ã„ã†Podã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚ãªãŠã€Podã«ã¯ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã‚’è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚



ã‚³ãƒ³ãƒ†ãƒŠã®CPUãƒªã‚½ãƒ¼ã‚¹è¦æ±‚ã¨ã—ã¦ã€200mã‚’è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚

resource-managementåå‰ç©ºé–“ã«è¨­å®šã•ã‚ŒãŸæœ€å¤§cpuåˆ¶ç´„ã®åŠåˆ†ã‚’ã€ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã¨ã—ã¦è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
k describe limitranges -n resource-management cpu-resource-constraint

ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ8
=========================================================
å•é¡Œ

1. cronã¨ã„ã†åå‰ç©ºé–“ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™CronJobã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¯alpineã‚’ä½¿ç”¨ã—ã€CronJobã®åå‰ã¯ps-cronã¨ã—ã¾ã™ã€‚ps-cronã¯"ps aux"ã‚³ãƒãƒ³ãƒ‰ã‚’1åˆ†æ¯ã«å®Ÿè¡Œã—ã€æˆåŠŸã—ãŸJobã‚’5ã€å¤±æ•—ã—ãŸJobã‚’3ã¾ã§ä¿å­˜ã—ã¾ã™ã€‚ã¾ãŸã€Jobã¯é–‹å§‹ã‹ã‚‰6ç§’çµŒéã—ãŸPodã‚’çµ‚äº†ã•ã›ã¾ã™ã€‚



2. CronJobã‹ã‚‰Jobã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚Jobåã¯ps-jobã¨ã—ã¾ã™ã€‚

---------------------------------------------------------


---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
kubectl create cronjob ps-cron -n cron \
  --image=alpine \
  --schedule="*/1 * * * *" \
  --dry-run=client -o yaml \
  -- sh -c "ps aux" > ps-cron.yaml
# ps-cron ã¨ã„ã†åå‰ã® CronJob ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ cron åå‰ç©ºé–“å‘ã‘ã«ç”Ÿæˆï¼ˆ1åˆ†æ¯å®Ÿè¡Œã€alpine ã§ ps auxã€é©ç”¨ã¯ã›ãš YAML å‡ºåŠ›ï¼‰

kubectl explain cj --recursive | grep success
# CronJobï¼ˆcjï¼‰ãƒªã‚½ãƒ¼ã‚¹å®šç¾©å…¨ä½“ã‚’å†å¸°çš„ã«è¡¨ç¤ºã—ã€â€™successâ€™ ã«é–¢ä¿‚ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡º

kubectl explain cj.spec | grep success
# CronJob.spec ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã€â€™successâ€™ ã«é–¢ã™ã‚‹èª¬æ˜è¡Œã‚’æ¤œç´¢

kubectl explain cj.spec
# CronJob.spec ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è©³ç´°ãªèª¬æ˜ã‚’è¡¨ç¤º

kubectl explain cj.spec.successfulJobsHistoryLimit
# CronJob.spec.successfulJobsHistoryLimit ã®æ„å‘³ã¨åˆ¶é™å€¤è¨­å®šæ–¹æ³•ã‚’è¡¨ç¤º

kubectl explain cj --recursive | grep active
# CronJob ãƒªã‚½ãƒ¼ã‚¹å®šç¾©å…¨ä½“ã‹ã‚‰ â€™activeâ€™ ã«é–¢ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡º

kubectl explain cj.spec.jobTemplate.spec --recursive | grep active
# CronJob.jobTemplate.spec å†…ã§ â€™activeâ€™ ã«é–¢ã‚ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å†å¸°çš„ã«æ¤œç´¢

kubectl explain cj.spec.jobTemplate.spec
# CronJob.spec.jobTemplate.spec ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤º

kubectl explain cj.spec.activeDeadlineSeconds
# CronJob.spec.activeDeadlineSeconds ã®èª¬æ˜ã‚’è¡¨ç¤ºï¼ˆJob ã‚’å¼·åˆ¶çµ‚äº†ã™ã‚‹ç§’æ•°åˆ¶é™ï¼‰


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ9
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

1. wgetã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®URLã‹ã‚‰yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/9/logger.yaml



2. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/9/resources.yaml



å•é¡Œ

adapteråå‰ç©ºé–“ã«ãŠã„ã¦ã€loggerã¨ã„ã†åå‰ã®PodãŒbusyboxã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚³ãƒ³ãƒ†ãƒŠã¯ã€10ç§’ã”ã¨ã«dateã‚³ãƒãƒ³ãƒ‰ã®çµæœã‚’JSONå½¢å¼ã§input.logãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜éŒ²ã—ã¾ã™ã€‚Podã¯emptyDirãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’/tmp/logãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆã—ã€input.logãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãã“ã«ä¿å­˜ã—ã¾ã™ã€‚



Podã«fluent/fluentd:edgeã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ ã—ã€/tmp/log/input.logã®å†…å®¹ã‚’/tmp/log/output/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®bufferãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ã¾ã™ã€‚æ¬¡ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„ã€‚



ã‚³ãƒ³ãƒ†ãƒŠåã‚’fluentdã«è¨­å®šã—ã¦ä¸‹ã•ã„

loggerã‚³ãƒ³ãƒ†ãƒŠã¨å…±æœ‰ã™ã‚‹ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’/tmp/logãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆã—ã¦ä¸‹ã•ã„ã€‚

/fluentd/etcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«fluentd-configmapã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
k exec -it -n adapter logger -c logger --sh


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ10
=========================================================
å•é¡Œ

contextã¨ã„ã†åå‰ç©ºé–“ã‚’ä½œæˆã—ã€ãã“ã«secure-redisã¨ã„ã†Podã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã¯ã€redis:alpineã‚’ä½¿ç”¨ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã®SecurityContextã«ã¯ä»¥ä¸‹ã®é …ç›®ã‚’è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚



ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: 2000ã§å®Ÿè¡Œã™ã‚‹ã€‚

Privilege escalationã‚’trueã¨ã™ã‚‹ã€‚

NET_ADMIN capabilityã‚’ä»˜ä¸ã™ã‚‹ã€‚

---------------------------------------------------------
---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
kubectl explain pod --recursive | grep SecurityContext  
# Pod ãƒªã‚½ãƒ¼ã‚¹å®šç¾©å…¨ä½“ã‚’å†å¸°çš„ã«è¡¨ç¤ºã—ã€SecurityContext ã«é–¢ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡º  

kubectl explain pod --recursive | grep Privilege  
# Pod å®šç¾©å†…ã‹ã‚‰ Privilege ã«é–¢é€£ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¤œç´¢  

kubectl explain pod.spec.containers.securityContext --recursive | grep Privilege  
# ã‚³ãƒ³ãƒ†ãƒŠã® securityContext ä¸‹ã§ Privilege é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å†å¸°çš„ã«æŠ½å‡º  

kubectl explain pod.spec.containers.securityContext.allowPrivilegeEscalation  
# allowPrivilegeEscalation ãƒ•ãƒ©ã‚°ã®æ„å‘³ã¨è¨­å®šæ–¹æ³•ã‚’è¡¨ç¤º  

kubectl get pod -n context secure-redis -o jsonpath="{.spec.containers[0].securityContext}"  
# context åå‰ç©ºé–“ã® secure-redis Pod ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã® securityContext è¨­å®šã‚’ JSON ãƒ‘ã‚¹ã§å–å¾—  

ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ11
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

1. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Ingress Controllerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä¸‹ã•ã„ã€‚

curl -s https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/11/init-ingress.sh | sh



2. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/11/resources.yaml



å•é¡Œ

path-ingressåå‰ç©ºé–“ã§ã¯ã€menu-svcã¨contact-svcã¨ã„ã†ClusterIPã‚¿ã‚¤ãƒ—ã®ServiceãŒã€ãã‚Œãã‚Œmenu-appã¨contact-appã¨ã„ã†Podã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã©ã¡ã‚‰ã®Serviceã‚‚ã€ãƒãƒ¼ãƒˆç•ªå·ã¯80ç•ªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

contact-svcã¯info-ingressã¨ã„ã†Ingressã«ã‚ˆã£ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã€http://path-ingress.info:31100/contactã‚’ä½¿ç”¨ã—ã¦contact-appã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚



info-ingressã‚’å¤‰æ›´ã—ã€http://path-ingress.info:31100/menuã‚’ä½¿ç”¨ã—ã¦menu-appã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹è¨­å®šã‚’è¿½åŠ ã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
curl http://path-ingress.info:31100/contact    # info-ingress çµŒç”±ã§ contact-app ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ç–é€šç¢ºèª
curl http://path-ingress.info:31100/menu       # menu-app ç”¨ã®ãƒ‘ã‚¹è¨­å®šå¾Œã«å‹•ä½œã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

kubectl explain ingress.spec --recursive | grep service    
# Ingress.spec ä»¥ä¸‹ã® service ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã‚’å†å¸°çš„ã«æ¤œç´¢ã—ã¦è¡¨ç¤º

kubectl explain ingress.spec.rules.http.paths.backend   
# Ingress ã® HTTP ãƒ«ãƒ¼ãƒ«ã§ backend ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆService åï¼ãƒãƒ¼ãƒˆæŒ‡å®šï¼‰ã®è©³ç´°ã‚’è¡¨ç¤º


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ12
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

1. wgetã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®URLã‹ã‚‰yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/12/payment.yaml



2. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/12/resources.yaml



å•é¡Œ

payåå‰ç©ºé–“ã§ã¯ã€payment  DeploymentãŒpayment-svcã¨ã„ã†Serviceã«ã‚ˆã‚Šã€NodePortç•ªå·31120ã‚’ä½¿ç”¨ã—ã¦å¤–éƒ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥ã‚’åˆ©ç”¨ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’Deploymentã§ä½œæˆã•ã‚Œã‚‹ãƒ¬ãƒ—ãƒªã‚«ã®20ï¼…ã«å±•é–‹ã—ã¦ä¸‹ã•ã„ã€‚ã¾ãŸã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¬ãƒ—ãƒªã‚«æ•°ã®åˆè¨ˆã¯5ã«è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚



1. paymentã¨åŒã˜Podã®æ§‹æˆã§ã€payment-canary ã¨ã„ã†Deploymentã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚app-versionãƒ©ãƒ™ãƒ«ã®å€¤ã«ã¯ã€canaryã‚’è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚ãƒ¬ãƒ—ãƒªã‚«æ•°ã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹åˆè¨ˆã®20ï¼…ã‚’è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚

ï¼ˆpayment.yamlã¯ã€payment Deploymentã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦payment-canary Deploymentã®ä½œæˆã«ä½¿ç”¨ã—ã¦ä¸‹ã•ã„ã€‚ï¼‰



2. payment-svcã‚’æ›´æ–°ã—ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®20ï¼…ã‚’payment-canaryã«é€ä¿¡ã—ã¦ä¸‹ã•ã„ã€‚



ãªãŠã€curl controlplane:31120ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§payment-svcã¸ã®æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹äº‹ãŒå‡ºæ¥ã¾ã™ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
k scale deploy -n pay payment --replicas=4


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»

k scale deployment payment -n pay --replicas=4      # payment Deployment ã‚’4ãƒ¬ãƒ—ãƒªã‚«ã«ã‚¹ã‚±ãƒ¼ãƒ«ã—ã€åˆè¨ˆãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’5ã«èª¿æ•´
k get deployment payment -n pay -o yaml > payment-canary.yaml   # æ—¢å­˜ payment Deployment ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›
# --- payment-canary.yaml ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›† ---
#   metadata.name: payment-canary         â† Deployment åã‚’å¤‰æ›´
#   metadata.labels:
#     app: payment                       â† å…ƒã® app ãƒ©ãƒ™ãƒ«ã‚’ãã®ã¾ã¾ç¶­æŒ
#     app-version: canary                â† canary ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
#   spec.replicas: 1                     â† ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’å…¨ä½“ã®20ï¼…(5ä¸­1)ã«è¨­å®š
#   spec.template.metadata.labels:       â† Pod ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚‚åŒã˜ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
#     app: payment
#     app-version: canary
k apply -f payment-canary.yaml    # payment-canary Deployment ã‚’ä½œæˆã—ã€canary Pod ã‚’1å°èµ·å‹•
k patch svc payment-svc -n pay -p '{"spec":{"selector":{"app":"payment"}}}'  # payment-svc ã® selector ã‚’ app=payment ã®ã¿ã«è¨­å®šã—ã€canary Pod ã‚’å«ã‚ã‚‹
k get endpoints payment-svc -n pay   # payment-svc ã«ç™»éŒ²ã•ã‚ŒãŸ Pod æ•°ãŒ5ï¼ˆ4 stable + 1 canaryï¼‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
k exec -n pay deploy/payment -- sh -c "curl -m 2 http://payment-svc:80"   # payment-svc çµŒç”±ã§ã‚¢ãƒ—ãƒªã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã€æ­£å¸¸å¿œç­”ã‚’æ¤œè¨¼



=========================================================
å•é¡Œ13
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/13/resources.yaml



å•é¡Œ

serveråå‰ç©ºé–“ã§ä½œæˆã•ã‚Œã¦ã„ã‚‹webapp Podã¯ã€bitnami/expressã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚Podã¯åŒã˜åå‰ç©ºé–“ã«ä½œæˆã•ã‚Œã¦ã„ã‚‹websvc Serviceã«ã‚ˆã£ã¦å…¬é–‹ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ç¾åœ¨ã€websvc Serviceã‚’é€šã˜ã¦webapp Podã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚websvc Serviceã®æ§‹æˆã‚’ç¢ºèªã—ã€å•é¡Œã®åŸå› ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚ãªãŠã€å¤‰æ›´ã¯websvcã«ã®ã¿é©ç”¨ã—ã€webapp Podã¯å¤‰æ›´ã—ãªã„ã§ä¸‹ã•ã„ã€‚

---------------------------------------------------------



---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
kubectl get svc                                      # serveråå‰ç©ºé–“ã®å…¨Serviceã‚’ä¸€è¦§è¡¨ç¤ºã—ã€websvcã®ã‚¿ã‚¤ãƒ—ã‚„ãƒãƒ¼ãƒˆè¨­å®šã‚’ç¢ºèª  
kubectl describe pod webapp -n server                 # webapp Podã®ãƒ©ãƒ™ãƒ«ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ãƒãƒ¼ãƒˆã‚’è©³ç´°è¡¨ç¤º  
kubectl describe svc websvc -n server                  # websvc Serviceã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚„ãƒãƒ¼ãƒˆè¨­å®šã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ…å ±ã‚’ç¢ºèª  
kubectl get endpoints websvc -n server                 # websvc Serviceã«ç´ã¥ãPodã®IPãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã€æœªç™»éŒ²ã‹ã©ã†ã‹ã‚’ç¢ºèª  
kubectl get nodes -o wide                              # å„ãƒãƒ¼ãƒ‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„æ¡ä»¶ã‚’ç¢ºèªã—ã€å¤–éƒ¨IPãŒå¿…è¦ã‹ã©ã†ã‹ã‚’åˆ¤æ–­  
kubectl edit svc websvc -n server                      # websvc Serviceã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ç·¨é›†ã—ã€ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚„ãƒãƒ¼ãƒˆè¨­å®šã‚’ä¿®æ­£  

ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ14
=========================================================
å•é¡Œ

1. rolling-updateã¨ã„ã†åå‰ç©ºé–“ã‚’ä½œæˆã—ã€rollingã¨ã„ã†åå‰ã®Deploymentã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯redis:6.2-alpineã‚’ä½¿ç”¨ã—ã€ãƒ¬ãƒ—ãƒªã‚«æ•°ã¯5ã¨ã—ã¾ã™ã€‚strategyã®typeã«ã¯RollingUpdateã‚’æŒ‡å®šã—ã€maxSurgeã‚’20%ã€maxUnavailableã‚’2ã«è¨­å®šã—ã¦ä¸‹ã•ã„ã€‚



2. kubectl setã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€rollingDeploymentãŒå®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’redis:7.2-alpineã«æ›´æ–°ã—ã¦ä¸‹ã•ã„ã€‚



3. rollingDeploymentã‚’ä¸€ã¤å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
kubectl explain deploy --recursive | grep RollingUpdate  
# Deployment ãƒªã‚½ãƒ¼ã‚¹å®šç¾©å…¨ä½“ã‚’å†å¸°çš„ã«è¡¨ç¤ºã—ã€RollingUpdate ã«é–¢ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡ºã—ã¦ç¢ºèª

kubectl explain deploy.spec.strategy --recursive | grep RollingUpdate  
# Deployment.spec.strategy ä»¥ä¸‹ã‚’å†å¸°çš„ã«è¡¨ç¤ºã—ã€RollingUpdate ã‚¿ã‚¤ãƒ—ã®è¨­å®šç®‡æ‰€ã‚’æ¤œç´¢

kubectl explain deploy.spec.strategy.rollingUpdate  
# strategy.rollingUpdate ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆmaxSurgeã€maxUnavailable ç­‰ï¼‰ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º

k get deploy -n rolling-update -o wide  
# rolling-update åå‰ç©ºé–“ã®å…¨ Deployment ã‚’è©³ç´°æƒ…å ±ä»˜ãã§ä¸€è¦§è¡¨ç¤ºï¼ˆãƒ¬ãƒ—ãƒªã‚«æ•°ã‚„æˆ¦ç•¥ã‚¿ã‚¤ãƒ—ç¢ºèªç”¨ï¼‰

k set image deploy rolling -n rolling-update redis=redis:7.2-alpine  
# rolling Deployment ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ redis:7.2-alpine ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’é–‹å§‹

k get deploy -n rolling-update -o wide  
# ã‚¤ãƒ¡ãƒ¼ã‚¸æ›´æ–°å¾Œã€Deployment ã®ç¾åœ¨ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚„ãƒ¬ãƒ—ãƒªã‚«çŠ¶æ…‹ã‚’å†åº¦ç¢ºèª

k rollout undo deploy rolling -n rolling-update  
# rolling Deployment ã‚’ä¸€ã¤å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ã€å…ƒã® redis:6.2-alpine ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æˆ»ã™


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
 å•é¡Œ15
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

1. wgetã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®URLã‹ã‚‰yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/15/web.yaml



2. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/15/resources.yaml



å•é¡Œ

probesåå‰ç©ºé–“ã§ã¯ã€webã¨ã„ã†åå‰ã®PodãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚web Podã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã‚‹Liveness Probeã¨Readiness Probeã‚’è¿½åŠ ã—ã¦ä¸‹ã•ã„ã€‚è©³ç´°ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚



Liveness Probeã§ã¯ã€80ç•ªãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦/liveã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£å¸¸ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™ã‹ã©ã†ã‹ã‚’èªè­˜ã—ã¾ã™ã€‚æœ€åˆã®Probeã‚’å®Ÿè¡Œã™ã‚‹å‰ã«5ç§’é–“å¾…æ©Ÿã—ã€ãã®å¾Œã€10ç§’ãŠãã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

Readiness Probeã§ã¯ã€80ç•ªãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦/readyã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£å¸¸ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™ã‹ã©ã†ã‹ã‚’èªè­˜ã—ã¾ã™ã€‚æœ€åˆã®Probeã‚’å®Ÿè¡Œã™ã‚‹å‰ã«15ç§’é–“å¾…æ©Ÿã—ã€ãã®å¾Œã€10ç§’ãŠãã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚



ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸweb.yamlã¯ã€web Podã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ä¸Šè¨˜ã®Liveness Probeã¨Readiness Probeã‚’web.yamlã«è¿½åŠ ã—ã€å®Ÿè¡Œä¸­ã®Podã«å¤‰æ›´ã‚’é©ç”¨ã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
kubectl explain pod. --recursive | grep Probe  
# Podãƒªã‚½ãƒ¼ã‚¹å®šç¾©ã‚’å†å¸°çš„ã«è¡¨ç¤ºã—ã€Probeã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡º

kubectl explain pod. --recursive | grep livenessProbe  
# Podãƒªã‚½ãƒ¼ã‚¹å®šç¾©ã‹ã‚‰ livenessProbe ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª¬æ˜è¡Œã‚’æ¤œç´¢

kubectl explain pod.spec.containers --recursive | grep livenessProb  
# Pod.spec.containers ä»¥ä¸‹ã®å®šç¾©ã‚’å†å¸°çš„ã«èª¿ã¹ã€livenessProb* ã«ãƒãƒƒãƒã™ã‚‹é …ç›®ã‚’æŠ½å‡º

kubectl explain pod.spec.containers.livenessProbe  
# ã‚³ãƒ³ãƒ†ãƒŠã® livenessProbe è¨­å®šï¼ˆHTTP GET ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰ã®è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤º


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ16
=========================================================
å•é¡Œ

1. helmã«bitnamiã¨ã„ã†åå‰ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¦ä¸‹ã•ã„ã€‚ãƒªãƒã‚¸ãƒˆãƒªã®URLã¯https://charts.bitnami.com/bitnamiã‚’ä½¿ç”¨ã—ã¦ä¸‹ã•ã„ã€‚



2. helm search repoã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦bitnami/nginxãƒãƒ£ãƒ¼ãƒˆãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚



3. helmã‚’ä½¿ç”¨ã—ã¦ckad-helmåå‰ç©ºé–“ã«bitnami/nginxãƒãƒ£ãƒ¼ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä¸‹ã•ã„ã€‚ãƒªãƒªãƒ¼ã‚¹åã¯my-nginxã¨ã—ã¾ã™ã€‚



4. helm listã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€my-nginxãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªå¾Œã€kubectl get deploy ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ¬ãƒ—ãƒªã‚«ã®æ•°ã‚’ç¢ºèªã—ã¦ä¸‹ã•ã„ã€‚



5. helm upgradeã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€my-nginxã®ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’2ã«æ›´æ–°ã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------
helmã¯ï¼£ï¼«ï¼¡ï¼¤å¯¾è±¡å¤–ãªã®ã§ã€ã‚¹ã‚­ãƒƒãƒ—
---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ17
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

1. wgetã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€æ¬¡ã®URLã‹ã‚‰å•é¡Œã«å¿…è¦ãªyamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚

wget https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/17/ckad-pv-claim.yaml



2. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/17/resources.yaml



å•é¡Œ

persistentåå‰ç©ºé–“ã§ã¯ã€ckad-pv Persistent Volumeã¨ckad-pv-claim Persistent Volume ClaimãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ckad-pv ã¯ã€ckad-pv-claim ã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ckad-pv-claimã®STATUSãŒPendingã«ãªã£ã¦ã„ã‚‹åŸå› ã‚’ç‰¹å®šã—ã€Boundã«ãªã‚‹æ§˜ã«ä¿®æ­£ã—ã¦ä¸‹ã•ã„ã€‚



ãªãŠã€ä¿®æ­£ã«ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸckad-pv-claim.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã€ckad-pv ã¯å¤‰æ›´ã—ãªã„ã§ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
k get pv,pvc -n persistent

ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»


=========================================================
å•é¡Œ18
=========================================================
ç’°å¢ƒæº–å‚™
cd /home/wsl/dev/k8s-ckad/wsl/test/
../script/reset-hard.sh

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚

kubectl apply -f https://raw.githubusercontent.com/nz-cloud-udemy/ckad-questions/main/practice-questions/18/resources.yaml



å•é¡Œ

sessionåå‰ç©ºé–“ã§ã¯ã€redis-deployã¨ã„ã†åå‰ã®DeploymentãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®Deploymentã¯ã€redis:alpineã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ¬ãƒ—ãƒªã‚«æ•°1ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ãŒã€ç¾åœ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ãŠã‚Šã€Podã®èµ·å‹•ã«å¤±æ•—ã—ã¦ã„ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ã®åŸå› ã‚’ç‰¹å®šã—ã€å•é¡Œã‚’è§£æ±ºã—ã¦ä¸‹ã•ã„ã€‚

---------------------------------------------------------

---------------------------------------------------------
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
kubectl get pods -n session
# ã‚¤ãƒ¡ãƒ¼ã‚¸åèª¤ã‚Šã§ Pod ãŒ Pending ã¾ãŸã¯ ImagePullBackOff ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

kubectl describe pod -n session $(kubectl get pod -n session -o name)
# Events æ¬„ã« ErrImagePull ã‚„ ImagePullBackOff, â€œnot foundâ€ ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã‚‹ã¯ãš

kubectl set image deployment/redis-deploy \
  -n session \
  redis=redis:alpine

# æ–°ã—ã„ Pod ãŒèµ·å‹•ã—ã¦ Ready ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
kubectl rollout status deployment/redis-deploy -n session

# Pod ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹
kubectl get pods -n session


ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»

